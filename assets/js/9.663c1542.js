(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{368:function(t,e,s){"use strict";s.r(e);var a=s(44),n=Object(a.a)({},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"chronicles"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#chronicles"}},[t._v("#")]),t._v(" Chronicles")]),t._v(" "),s("p",[t._v("Chronicles is a library for structured logging. It adheres to the philosophy\nthat log files shouldn't be based on formatted text strings, but rather on\nwell-defined event records with arbitrary properties that are easy to read\nfor both humans and machines. Let's illustrate this with an example:")]),t._v(" "),s("div",{staticClass:"language-nim line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-nim"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" net"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" chronicles\n\nsocket"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("accept")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".)")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\ndebug "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Client PSK"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" psk "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" client"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),t._v("getPskIdentity\ninfo "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"New incoming connection"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" remoteAddr "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ip"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" remotePort "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" port\n\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br")])]),s("p",[t._v("Here, "),s("code",[t._v("debug")]),t._v(" and "),s("code",[t._v("info")]),t._v(" are logging statements, corresponding to different\nseverity levels. You can think of their first argument as the name of a\nparticular event that happened during the execution of the program, while\nthe rest of the arguments are the properties of this event.")]),t._v(" "),s("p",[t._v("From these logging statements, Chronicles can be configured to produce log\noutput in various structured formats. The default format is called "),s("code",[t._v("textlines")]),t._v("\nand it looks like this:")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://github.com/status-im/nim-chronicles/raw/master/media/textlines.svg?sanitize=true",alt:"textblocks format example"}})]),t._v(" "),s("p",[t._v("This format is compatible with tooling written for\n"),s("a",{attrs:{href:"https://brandur.org/logfmt",target:"_blank",rel:"noopener noreferrer"}},[t._v("heroku/logfmt"),s("OutboundLink")],1),t._v(".")]),t._v(" "),s("p",[t._v("Alternatively, you can use a multi-line format called "),s("code",[t._v("textblocks")]),t._v(":")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://github.com/status-im/nim-chronicles/raw/master/media/textblocks.svg?sanitize=true",alt:"textblocks format example"}})]),t._v(" "),s("p",[t._v("While these human-readable formats provide a more traditional and familiar\nexperience of using a logging library, the true power of Chronicles is\nunlocked only after switching to the "),s("code",[t._v("JSON")]),t._v(" format. Then, the same log output\nwill look like this:")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://github.com/status-im/nim-chronicles/raw/master/media/json.svg?sanitize=true",alt:"json format example"}})]),t._v(" "),s("p",[t._v("At first, switching to JSON may look like a daunting proposition, but\nChronicles provides a customized log tailing program called "),s("code",[t._v("chronicles-tail")]),t._v("\nwhich is able to transform the JSON stream back into the familiar human-readable\nform, while also providing additional advanced features such as on on-the-fly\nfiltering, sound alerts and more.")]),t._v(" "),s("p",[t._v("The main advantage of using JSON logging is that this facilitates the storage\nof the log records in specialized databases which are usually able to provide\nsearch and filtering capabilities and allow you to compute various aggregated\nmetrics and time-series data from the accumulated logs.")]),t._v(" "),s("p",[t._v("Typical log storage choices for the above are open-source search engines such\nas "),s("a",{attrs:{href:"https://www.elastic.co/",target:"_blank",rel:"noopener noreferrer"}},[t._v("ElasticSearch"),s("OutboundLink")],1),t._v(" or specialized providers such as "),s("a",{attrs:{href:"https://www.loggly.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Loggly"),s("OutboundLink")],1),t._v(".")]),t._v(" "),s("h2",{attrs:{id:"logging-scopes"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#logging-scopes"}},[t._v("#")]),t._v(" Logging Scopes")]),t._v(" "),s("p",[t._v("In the introduction, we saw "),s("code",[t._v("debug")]),t._v(" and "),s("code",[t._v("info")]),t._v(" as examples for logging\nstatements. Other similar statements include "),s("code",[t._v("trace")]),t._v(", "),s("code",[t._v("notice")]),t._v(", "),s("code",[t._v("warn")]),t._v(", "),s("code",[t._v("error")]),t._v("\nand "),s("code",[t._v("fatal")]),t._v(". All of these statements accept arbitrary key-value pairs.\nAs a short-cut, you are also allowed to specify only the name of a particular\nvariable and Chronicles will create a key with the same name (i.e. passing\na local variable named "),s("code",[t._v("foo")]),t._v(" will be translated to the pair "),s("code",[t._v("foo = foo")]),t._v(").")]),t._v(" "),s("p",[t._v("A common practice enforced in other logging libraries is to associate\nthe logging records with the name of the component that produced them\nor with a particular run-time property such as "),s("code",[t._v("RequestID")]),t._v(". Chronicles\nprovides two general-purpose facilities for assigning such properties\nin an automated way:")]),t._v(" "),s("h3",{attrs:{id:"logscope"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#logscope"}},[t._v("#")]),t._v(" "),s("code",[t._v("logScope")])]),t._v(" "),s("p",[s("code",[t._v("logScope")]),t._v(" can be used to introduce additional properties that will be\nautomatically attached to all logging statements in the current lexical\nscope:")]),t._v(" "),s("div",{staticClass:"language-nim line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-nim"}},[s("code",[t._v("logScope"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Lexical properties are typically assigned to a constant:")]),t._v("\n  topics "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"rendering opengl"')]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# But you can also assign an expression that will be")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# evaluated on every log statement:")]),t._v("\n  memoryUsage "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("currentMemUsage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proc")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("renderFrame")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".)")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("\n  inc frameCounter\n\n  logScope"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# You can add additional properties in any scope. Only logging")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# statements that are in the same lexical scope will be affected:")]),t._v("\n    frame "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" frameCounter\n\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" t "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("startTimer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  debug "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Frame started"')]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("glFinish")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  debug "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Frame finished"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" totalPrimitives"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" frameTime "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),t._v("elapsed\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br"),s("span",{staticClass:"line-number"},[t._v("23")]),s("br")])]),s("p",[t._v("A "),s("code",[t._v("logScope")]),t._v(" is usually put near the top of a Nim module and used to\nspecify statically assigned properties such as message origin, component\nname, etc. The special "),s("code",[t._v("topics")]),t._v(" property demonstrated here is important\nfor the log filtering mechanism, which will be explained in more details\nlater. If present, this property will always appear first in the formatted\nlog output.")]),t._v(" "),s("h3",{attrs:{id:"publiclogscope"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#publiclogscope"}},[t._v("#")]),t._v(" "),s("code",[t._v("publicLogScope")])]),t._v(" "),s("p",[t._v("While a "),s("code",[t._v("logScope")]),t._v(" affects only the current module, a "),s("code",[t._v("publicLogScope")]),t._v("\nallows you to specify a set of custom properties that may affect your\nentire program. For example, if you have an application running in a\nserver cluster, you may want to assign a property such as "),s("code",[t._v("serverId")]),t._v("\nto every record. To achieve this, create a proxy logging module\nimporting "),s("code",[t._v("chronicles")]),t._v(" and setting up a "),s("code",[t._v("publicLogScope")]),t._v(":")]),t._v(" "),s("div",{staticClass:"language-nim line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-nim"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# logging.nim")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" chronicles\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proc")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getServerId"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\npublicLogScope"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n  serverId "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getServerId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br")])]),s("p",[t._v("Every other module importing the proxy module will be able to use the\nentire Chronicles API and will be affected by the public scope.\nIn fact, you should not import "),s("code",[t._v("chronicles")]),t._v(" from such modules, because\nthis will lead to ambiguous symbols such as "),s("code",[t._v("activeChroniclesScope")]),t._v(" and\n"),s("code",[t._v("activeChroniclesStream")]),t._v(".")]),t._v(" "),s("p",[t._v("Using Nim's "),s("code",[t._v("--import:")]),t._v(" option may be a good way to enforce the use of\nthe proxy module in your entire program.")]),t._v(" "),s("h3",{attrs:{id:"dynamiclogscope"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#dynamiclogscope"}},[t._v("#")]),t._v(" "),s("code",[t._v("dynamicLogScope")])]),t._v(" "),s("p",[t._v("A "),s("code",[t._v("dynamicLogScope")]),t._v(" is a construct accepting a block of code that can be\nused to attach properties to all logging statements that will be executed\nanywhere within the tree of calls originating from the said block. The key\ndifference with the lexically bound properties is that this includes\nlogging statements from other modules, which are not within the lexical\nscope of the "),s("code",[t._v("dynamicLogScope")]),t._v(" statement.")]),t._v(" "),s("p",[t._v("If you still find the distinction between lexical and dynamic scopes confusing,\nreading the following explanation may help you:")]),t._v(" "),s("p",[t._v("http://wiki.c2.com/?DynamicScoping")]),t._v(" "),s("p",[t._v("A dynamic scope is usually used to track the reason why a particular\nlibrary function is being called (e.g. you are opening a file as a result\nof a particular network request):")]),t._v(" "),s("div",{staticClass:"language-nim line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-nim"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proc")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("onNewRequest")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("\n  inc reqID\n  info "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"request received"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" reqID"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" origin "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" req"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),t._v("remoteAddress\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("dynamicLogScope")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("reqID"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# All logging statements triggered before the current block returns")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# will feature the reqID property. This includes logging statements")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# from other modules.")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("handleRequest")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br")])]),s("p",[t._v("Just like regular log statements, "),s("code",[t._v("dynamicLogScope")]),t._v(" accepts a list of arbitrary\nkey-value pairs. The use of "),s("code",[t._v("reqID")]),t._v(" in the example above is a convenient short\nform for specifying the pair "),s("code",[t._v("reqID = reqID")]),t._v(".")]),t._v(" "),s("p",[t._v("While the properties associated with lexical scopes are lazily evaluated as\npreviously demonstrated, all expressions at the beginning of a dynamic scope\nwill be eagerly evaluated before the block is entered.")]),t._v(" "),s("h2",{attrs:{id:"compile-time-configuration"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#compile-time-configuration"}},[t._v("#")]),t._v(" Compile-Time Configuration")]),t._v(" "),s("p",[t._v("Almost everything about Chronicles in configured at compile-time, through the\nmechanism of Nim's "),s("code",[t._v("-d:")]),t._v(" flags. For example, you can completely remove all of\nthe code related to logging by simply setting "),s("code",[t._v("chronicles_enabled")]),t._v(" to "),s("code",[t._v("off")]),t._v(":")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("nim c -d:chronicles_enabled=off myprogram.nim\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[t._v("Chronicles comes with a very reasonable default configuration, but let's look\nat some of the other supported options:")]),t._v(" "),s("h3",{attrs:{id:"chronicles-sinks"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#chronicles-sinks"}},[t._v("#")]),t._v(" chronicles_sinks")]),t._v(" "),s("p",[t._v("Chronicles supports producing log records in multiple formats and writing\nthose to various destinations such as the std streams, the system's syslog\ndaemon, or to one or more log files.")]),t._v(" "),s("p",[t._v("The combination of a log format and one or more associated log destinations\nis called a 'sink'. You can use the "),s("code",[t._v("chronicles_sinks")]),t._v(" option to provide the\nlist of sinks that will be used in your program.")]),t._v(" "),s("p",[t._v("The sinks are specified as a comma-separated list of valid Nim expressions\nthat will be better illustrated by the following examples:")]),t._v(" "),s("ul",[s("li",[s("p",[s("code",[t._v("json")])]),t._v(" "),s("p",[t._v("Write JSON-records to stdout")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("json[file]")])]),t._v(" "),s("p",[t._v("Write JSON-records to a file in the current directory named after the\napplication itself.")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("textblocks[stdout,file(/var/log/myapp.log)]")])]),t._v(" "),s("p",[t._v("Use the 'textblocks' format and send the output both to stdout and\nto a file with an absolute path /var/log/myapp.log")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("textlines[notimestamps,file(myapp.txt),syslog]")])]),t._v(" "),s("p",[t._v("Use the 'textlines' format, but don't include timestamps and write\nboth to a file named 'myapp.txt' with a relative path to the current\nworking directory and also to syslog.")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("textlines[nocolors],json[file(logs/myapp.json,truncate)]")])]),t._v(" "),s("p",[t._v("Send the output both in the 'textlines' format to stdout (but without\nusing colors) and to a JSON file named myapp.json in the relative\ndirectory 'logs'. The  myapp.json file will be truncated on each\nprogram execution.")])])]),t._v(" "),s("p",[t._v("The built-in formats include "),s("code",[t._v("json")]),t._v(", "),s("code",[t._v("textlines")]),t._v(" and "),s("code",[t._v("textblocks")]),t._v(", which\nsupport options for specifying the use of colors and timestamps (for more\ninfo see "),s("code",[t._v("chronicles_colors")]),t._v(" and "),s("code",[t._v("chronicles_timestamps")]),t._v(").")]),t._v(" "),s("p",[t._v("The possible log destinations are "),s("code",[t._v("stdout")]),t._v(", "),s("code",[t._v("stderr")]),t._v(", "),s("code",[t._v("file")]),t._v(", "),s("code",[t._v("syslog")]),t._v("\nand "),s("code",[t._v("dynamic")]),t._v(".")]),t._v(" "),s("p",[t._v("Please note that Chronicles also allows you to implement custom logging\nformats through the use of the "),s("code",[t._v("customLogStream")]),t._v(" facility.")]),t._v(" "),s("h3",{attrs:{id:"chronicles-default-output-device"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#chronicles-default-output-device"}},[t._v("#")]),t._v(" chronicles_default_output_device")]),t._v(" "),s("p",[t._v('When a sink doesn\'t explicitly specify a particular log destination,\nChronicles will log to "stdout" by default. Use this define to specify\na different default choice.')]),t._v(" "),s("h3",{attrs:{id:"chronicles-streams"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#chronicles-streams"}},[t._v("#")]),t._v(" chronicles_streams")]),t._v(" "),s("p",[t._v("While having multiple log sinks enables you to record the same stream of\nevents in multiple formats and destinations, "),s("code",[t._v("chronicles_streams")]),t._v(" allows\nyou to define additional independent streams of events identified by their\nname. In the code, each logging statement is associated with exactly one\nlog stream, which in turn has an associated list of sinks.")]),t._v(" "),s("p",[t._v("The syntax for defining streams closely resembles the syntax for defining\nsinks:")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("textlog[textlines],transactions[json[file(transactions.json)]]")])])]),t._v(" "),s("p",[t._v("This will create two streams, called "),s("code",[t._v("textlog")]),t._v(" and "),s("code",[t._v("transactions")]),t._v(".\nThe former will be considered the default stream associated with unqualified\nlogging statements, but each of the streams will exist as a separate symbol\nin the code, supporting the full set of logging operations:")]),t._v(" "),s("div",{staticClass:"language-nim line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-nim"}},[s("code",[t._v("textlog"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),t._v("debug "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"about to create a transaction"')]),t._v("\ntransactions"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),t._v("info "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"transaction created"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" buyer "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" alice"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" seller "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" bob\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br")])]),s("p",[t._v("The streams created through "),s("code",[t._v("chronicles_streams")]),t._v(" will be exported by the\n"),s("code",[t._v("chronicles")]),t._v(" module itself, but you can also introduce additional streams\nin your own modules by using the helpers "),s("code",[t._v("logStream")]),t._v(" and "),s("code",[t._v("customLogStream")]),t._v(".")]),t._v(" "),s("h3",{attrs:{id:"chronicles-enabled-topics"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#chronicles-enabled-topics"}},[t._v("#")]),t._v(" chronicles_enabled_topics")]),t._v(" "),s("p",[t._v("All logging statements may be associated with a statically known list of\ntopics. Usually, this is done by specifying the "),s("code",[t._v("topics")]),t._v(" property in a\nparticular "),s("code",[t._v("logScope")]),t._v(", but you can also specify it for individual log\nstatements.")]),t._v(" "),s("p",[t._v("You can use the "),s("code",[t._v("chronicles_enabled_topics")]),t._v(" option to specify the list of\ntopics for which the logging statements should produce output. All other\nlogging statements will be erased at compile-time from the final code.\nWhen the list includes multiple topics, any of them is considered a match.")]),t._v(" "),s("blockquote",[s("p",[t._v("In both contexts, the list of topics is written as a comma or space-separated\nstring of case-sensitive topic names.")])]),t._v(" "),s("p",[t._v("In the list of topics, you can also optionally provide a log level after the\ntopic, separated with a colon from the topic. If a log level is provided it will\noverrule the "),s("code",[t._v("chronicles_log_level")]),t._v(" setting. The log level can be defined as\n"),s("code",[t._v("LogLevel")]),t._v(" values or directly as the corresponding integer values.")]),t._v(" "),s("p",[t._v("e.g. "),s("code",[t._v("-d:chronicles_enabled_topics:MyTopic:DEBUG,AnotherTopic:5")])]),t._v(" "),s("h3",{attrs:{id:"chronicles-required-topics"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#chronicles-required-topics"}},[t._v("#")]),t._v(" chronicles_required_topics")]),t._v(" "),s("p",[t._v("Similar to "),s("code",[t._v("chronicles_enabled_topics")]),t._v(", but requires the logging statements\nto have all of the topics specified in this list.")]),t._v(" "),s("p",[t._v("You cannot specify "),s("code",[t._v("chronicles_enabled_topics")]),t._v(" and "),s("code",[t._v("chronicles_required_topics")]),t._v("\nat the same time.")]),t._v(" "),s("h3",{attrs:{id:"chronicles-disabled-topics"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#chronicles-disabled-topics"}},[t._v("#")]),t._v(" chronicles_disabled_topics")]),t._v(" "),s("p",[t._v("The dual of "),s("code",[t._v("chronicles_enabled_topics")]),t._v(". This option specifies a black-list\nof topics for which the associated logging statements should be erased from\nthe program.")]),t._v(" "),s("p",[t._v("Topics in "),s("code",[t._v("chronicles_disabled_topics")]),t._v(" have precedence over the ones in\n"),s("code",[t._v("chronicles_enabled_topics")]),t._v(" or "),s("code",[t._v("chronicles_required_topics")]),t._v(".")]),t._v(" "),s("h3",{attrs:{id:"chronicles-disable-thread-id"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#chronicles-disable-thread-id"}},[t._v("#")]),t._v(" chronicles_disable_thread_id")]),t._v(" "),s("p",[t._v("Disable log thread(tid)")]),t._v(" "),s("h3",{attrs:{id:"chronicles-log-level"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#chronicles-log-level"}},[t._v("#")]),t._v(" chronicles_log_level")]),t._v(" "),s("p",[t._v("This option can be used to erase at compile-time all log statements, not\nmatching the specified minimum log level.")]),t._v(" "),s("p",[t._v("Possible values are "),s("code",[t._v("TRACE")]),t._v(", "),s("code",[t._v("DEBUG")]),t._v(", "),s("code",[t._v("INFO")]),t._v(", "),s("code",[t._v("NOTICE")]),t._v(", "),s("code",[t._v("WARN")]),t._v(", "),s("code",[t._v("ERROR")]),t._v(", "),s("code",[t._v("FATAL")]),t._v(",\nand "),s("code",[t._v("NONE")]),t._v(". The default value is "),s("code",[t._v("DEBUG")]),t._v(" in debug builds and "),s("code",[t._v("INFO")]),t._v(" in\nrelease mode.")]),t._v(" "),s("h3",{attrs:{id:"chronicles-runtime-filtering"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#chronicles-runtime-filtering"}},[t._v("#")]),t._v(" chronicles_runtime_filtering")]),t._v(" "),s("p",[t._v("This option enables the run-filtering capabilities of Chronicles.\nThe run-time filtering is controlled through the procs "),s("code",[t._v("setLogLevel")]),t._v("\nand "),s("code",[t._v("setTopicState")]),t._v(":")]),t._v(" "),s("div",{staticClass:"language-nim line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-nim"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" LogLevel "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("enum")]),t._v("\n  NONE"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" TRACE"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" DEBUG"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" INFO"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" NOTICE"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" WARN"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ERROR"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" FATAL\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proc")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setLogLevel"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("level"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" LogLevel"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" TopicState "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("enum")]),t._v("\n  Normal"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Enabled"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Required"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Disabled\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proc")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTopicState"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" string"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                    newState"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" TopicState"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                    logLevel "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" LogLevel"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),t._v("NONE"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" bool\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br")])]),s("p",[t._v("The log levels available at runtime - and therefor to "),s("code",[t._v("setLogLevel()")]),t._v(" - are\nthose greater than or equal to the one set at compile time by\n"),s("code",[t._v("chronicles_log_level")]),t._v(".")]),t._v(" "),s("p",[t._v("It is also possible for a specific topic to overrule the global "),s("code",[t._v("LogLevel")]),t._v(", set\nby "),s("code",[t._v("setLogLevel")]),t._v(", by setting the optional "),s("code",[t._v("logLevel")]),t._v(" parameter in\n"),s("code",[t._v("setTopicState")]),t._v(" to a valid "),s("code",[t._v("LogLevel")]),t._v(".")]),t._v(" "),s("p",[t._v("The option is disabled by default because we recommend filtering the\nlog output in a tailing program. This allows you to still look at all\nlogged events in case this becomes necessary. Set the option to "),s("code",[t._v("on")]),t._v("\nto enable it.")]),t._v(" "),s("h3",{attrs:{id:"chronicles-timestamps"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#chronicles-timestamps"}},[t._v("#")]),t._v(" chronicles_timestamps")]),t._v(" "),s("p",[t._v("This option controls the use of timestamps in the log output.\nPossible values are:")]),t._v(" "),s("ul",[s("li",[s("p",[s("code",[t._v("RfcTime")]),t._v(" (used by default)")]),t._v(" "),s("p",[t._v("Chronicles will use the human-readable format specified in\nRFC 3339: Date and Time on the Internet: Timestamps")]),t._v(" "),s("p",[t._v("https://tools.ietf.org/html/rfc3339")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("UnixTime")])]),t._v(" "),s("p",[t._v('Chronicles will write a single float value for the number\nof seconds since the "Unix epoch"')]),t._v(" "),s("p",[t._v("https://en.wikipedia.org/wiki/Unix_time")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("None")]),t._v(" or "),s("code",[t._v("NoTimestamps")])]),t._v(" "),s("p",[t._v("Chronicles will not include timestamps in the log output.")])])]),t._v(" "),s("p",[t._v("Please note that the timestamp format can also be specified\nfor individual sinks (see "),s("code",[t._v("chronicles_sinks")]),t._v(").")]),t._v(" "),s("h3",{attrs:{id:"chronicles-line-numbers"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#chronicles-line-numbers"}},[t._v("#")]),t._v(" chronicles_line_numbers")]),t._v(" "),s("p",[t._v("This option, disabled by default, enables the display of filename and line number\nwhere each record was instantiated. It adds a property "),s("code",[t._v("file")]),t._v(" to the output, for example:")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("file: example.nim:15\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[t._v("While "),s("code",[t._v("chronicles_line_numbers")]),t._v(" sets the default option for all records, it is\nalso possible to control the same property in a lexical scope or for a particular\nlog statement with "),s("code",[t._v("chroniclesLineNumbers")]),t._v(", which can be either "),s("code",[t._v("true")]),t._v(" or "),s("code",[t._v("false")]),t._v(".")]),t._v(" "),s("h3",{attrs:{id:"chronicles-colors"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#chronicles-colors"}},[t._v("#")]),t._v(" chronicles_colors")]),t._v(" "),s("p",[t._v("This option controls the default color scheme used by Chronicles for\nits human-readable text formats when sent to the standard output streams.")]),t._v(" "),s("p",[t._v("Possible values are:")]),t._v(" "),s("ul",[s("li",[s("p",[s("code",[t._v("NativeColors")]),t._v(" (used by default)")]),t._v(" "),s("p",[t._v("In this mode, Windows builds will produce output suitable for the console\napplication in older versions of Windows. On Unix-like systems, ANSI codes\nare still used.")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("AnsiColors")])]),t._v(" "),s("p",[t._v("Output suitable for terminals supporting the standard ANSI escape codes:\nhttps://en.wikipedia.org/wiki/ANSI_escape_code")]),t._v(" "),s("p",[t._v("This includes most terminal emulators on modern Unix-like systems,\nWindows console replacements such as ConEmu, and the native Console\nand PowerShell applications on Windows 10.")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("None")]),t._v(" or "),s("code",[t._v("NoColors")])]),t._v(" "),s("p",[t._v("Chronicles will produce color-less output. Please note that this is the\ndefault mode for sinks logging only to files or for sinks using the json\nformat.")])])]),t._v(" "),s("p",[t._v("Current known limitations:")]),t._v(" "),s("ul",[s("li",[t._v("Chronicles will not try to detect if the standard outputs\nof the program are being redirected to another program or a file.\nIt's typical for the colored output to be disabled in such circumstances.\n("),s("a",{attrs:{href:"https://github.com/status-im/nim-chronicles/issues/1",target:"_blank",rel:"noopener noreferrer"}},[t._v("issue"),s("OutboundLink")],1),t._v(")")])]),t._v(" "),s("h3",{attrs:{id:"chronicles-indent"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#chronicles-indent"}},[t._v("#")]),t._v(" chronicles_indent")]),t._v(" "),s("p",[t._v("This option sets the desired number of spaces that Chronicles should\nuse as indentation in the "),s("code",[t._v("textblocks")]),t._v(" format.")]),t._v(" "),s("hr"),t._v(" "),s("p",[t._v("All of the discussed options are case-insensitive and accept a number of\ntruthy and falsy values such as "),s("code",[t._v("on")]),t._v(", "),s("code",[t._v("off")]),t._v(", "),s("code",[t._v("true")]),t._v(", "),s("code",[t._v("false")]),t._v(", "),s("code",[t._v("0")]),t._v(", "),s("code",[t._v("1")]),t._v(",\n"),s("code",[t._v("yes")]),t._v(", "),s("code",[t._v("no")]),t._v(" or "),s("code",[t._v("none")]),t._v(".")]),t._v(" "),s("h2",{attrs:{id:"working-with-file-outputs"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#working-with-file-outputs"}},[t._v("#")]),t._v(" Working with "),s("code",[t._v("file")]),t._v(" outputs")]),t._v(" "),s("p",[t._v("When a stream has "),s("code",[t._v("file")]),t._v(" outputs, you may choose to provide the log file\nlocation at run-time. Chronicles will create each log file lazily when the\nfirst log record is written. This gives you a chance to modify the default\ncompile-time path associated with each file output by calling the "),s("code",[t._v("open")]),t._v("\nproc on an "),s("code",[t._v("output")]),t._v(" symbol associated with the stream:")]),t._v(" "),s("div",{staticClass:"language-nim line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-nim"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# my_program.nim")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" config "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("loadConfiguration")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" success "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" defaultChroniclesStream"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),t._v("output"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("open")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("config"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),t._v("logFile"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" fmAppend"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\ninfo "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"APPLICATION STARTED"')]),t._v("\n\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br")])]),s("p",[t._v("Compiled with:")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("nim c -d:chronicles_sinks=textlines[file] my_program.nim\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[t._v("As you can see above, the default stream in Chronicles is called\n"),s("code",[t._v("defaultChroniclesStream")]),t._v(". If the stream had multiple file outputs,\nthey would have been accessible separately as "),s("code",[t._v("outputs[0]")]),t._v(", "),s("code",[t._v("outputs[1]")]),t._v("\nand so on. "),s("code",[t._v("output")]),t._v(" is a simple short-cut referring to the first of them.")]),t._v(" "),s("p",[t._v("When the compile-time configuration doesn't specify a default file name for\na particular file output, Chronicles will use the following rules for picking\nthe default automatically:")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("The log file is created in the current working directory and its name\nmatches the name of the stream (plus a "),s("code",[t._v(".log")]),t._v(" extension). The exception\nfor this rule is the default stream, for which the log file will be\nassigned the name of the application binary.")])]),t._v(" "),s("li",[s("p",[t._v("If more than one unnamed file outputs exist for a given stream,\nchronicles will add an index such as "),s("code",[t._v(".2.log")]),t._v(", "),s("code",[t._v(".3.log")]),t._v(" .. "),s("code",[t._v(".N.log")]),t._v("\nto the final file name.")])])]),t._v(" "),s("h2",{attrs:{id:"working-with-dynamic-outputs"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#working-with-dynamic-outputs"}},[t._v("#")]),t._v(" Working with "),s("code",[t._v("dynamic")]),t._v(" outputs")]),t._v(" "),s("p",[t._v("A "),s("code",[t._v("dynamic")]),t._v(" output redirects all logged messages to a closure supplied by\nthe host application. Similar to working with file ouputs "),s("a",{attrs:{href:"#working-with-file-outputs"}},[t._v("file outputs")]),t._v(",\nyou can use the "),s("code",[t._v("output")]),t._v(" and "),s("code",[t._v("outputs")]),t._v(" properties of a Chronicles stream\nto specify a gcsafe closure:")]),t._v(" "),s("div",{staticClass:"language-nim line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-nim"}},[s("code",[t._v("defaultChroniclesStream"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),t._v("output"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),t._v("writer "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proc")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("logLevel"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" LogLevel"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" msg"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" LogOutputStr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{.")]),t._v("gcsafe"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("\n    database"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("writeLogEntry")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("msg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br")])]),s("h2",{attrs:{id:"using-chronicles-with-nosideeffect"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#using-chronicles-with-nosideeffect"}},[t._v("#")]),t._v(" Using Chronicles with "),s("code",[t._v("{.noSideEffect.}")])]),t._v(" "),s("p",[t._v("Usage of Chronicles from "),s("code",[t._v("noSideEffect")]),t._v(" procs (or "),s("code",[t._v("func")]),t._v(") is limited to the\n"),s("code",[t._v("trace")]),t._v(" statement. Normal logging can be considered a side effect, but "),s("code",[t._v("trace")]),t._v("\nis meant as a debugging aid. It's analogous to Nim's "),s("code",[t._v("debugEcho")]),t._v(", which also\nbypasses the effect system.")]),t._v(" "),s("h2",{attrs:{id:"teaching-chronicles-about-your-types"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#teaching-chronicles-about-your-types"}},[t._v("#")]),t._v(" Teaching Chronicles about your types")]),t._v(" "),s("p",[t._v("Chronicles can output log records in any of the formats supported by the Nim\n"),s("a",{attrs:{href:"https://github.com/status-im/nim-serialization",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("serialization")]),s("OutboundLink")],1),t._v(" package.\nWhen you specify a named format such as "),s("code",[t._v("json")]),t._v(", Chronicles will expect that\nyour project also depends on the respective serialization package (e.g.\n"),s("a",{attrs:{href:"https://github.com/status-im/nim-json-serialization",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("json_serialization")]),s("OutboundLink")],1),t._v(").")]),t._v(" "),s("p",[t._v("In the text formats ("),s("code",[t._v("textlines")]),t._v(" and "),s("code",[t._v("textblocks")]),t._v("), the Nim's standard "),s("code",[t._v("$")]),t._v("\noperator will be used to convert the logged properties to strings.")]),t._v(" "),s("h3",{attrs:{id:"formatit"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#formatit"}},[t._v("#")]),t._v(" "),s("code",[t._v("formatIt")])]),t._v(" "),s("p",[t._v("You can instruct Chronicles to alter this default behavior for a particular\ntype by providing a "),s("code",[t._v("chronicles.formatIt")]),t._v(" override:")]),t._v(" "),s("div",{staticClass:"language-nim line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-nim"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" Dollar "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("distinct")]),t._v(" int\nchronicles"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("formatIt")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Dollar"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"$"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("$")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("it"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),t._v("int"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br")])]),s("p",[t._v("The "),s("code",[t._v("formatIt")]),t._v(" block can evaluate to any expression that will be then\nsubjected to the standard serialization logic described above.")]),t._v(" "),s("h3",{attrs:{id:"expandit"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#expandit"}},[t._v("#")]),t._v(" "),s("code",[t._v("expandIt")])]),t._v(" "),s("p",[t._v("The "),s("code",[t._v("expandIt")]),t._v(" override can be used to turn any logged property of a\nparticular type into multiple properties:")]),t._v(" "),s("div",{staticClass:"language-nim line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-nim"}},[s("code",[t._v("chronicles"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("expandIt")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("EncryptedEnvelope"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n  peer "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" it"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),t._v("fromAddress\n  msg  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" it"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),t._v("decryptMsg\n\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" e "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("EncryptedEnvelope")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".)")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# The following two statements are equivalent:")]),t._v("\ninfo "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Received message"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" e\ninfo "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Received message"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" peer "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" e"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),t._v("fromAddress"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" msg "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" e"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),t._v("decryptMsg\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br")])]),s("p",[t._v("You can also derive the names of the expanded properties from the name of\nthe original logged property. This is achieved by using the Nim's backticks\nsyntax to construct the expanded property names:")]),t._v(" "),s("div",{staticClass:"language-nim line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-nim"}},[s("code",[t._v("chronicles"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("expandIt")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("User"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# You can use both identifiers and string literals:")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token ignore"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("it Name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" it"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),t._v("name\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("it "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"LastSeen"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" it"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),t._v("lastSeen\n\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" alice "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("User")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Alice"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".)")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# The following two statements are equivalent:")]),t._v("\ninfo "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Sending message"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" recipient "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" alice\ninfo "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Sending message"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" recipientName "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" alice"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" recipientLastSeen "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" alice"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),t._v("lastSeen\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br")])]),s("h2",{attrs:{id:"custom-log-streams"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#custom-log-streams"}},[t._v("#")]),t._v(" Custom Log Streams")]),t._v(" "),s("h3",{attrs:{id:"logstream"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#logstream"}},[t._v("#")]),t._v(" "),s("code",[t._v("logStream")])]),t._v(" "),s("p",[t._v("As an alternative to specifying multiple output streams with the\n"),s("code",[t._v("chronicles_streams")]),t._v(" option, you can also introduce additional\nstreams within the code of your program. A typical way to do this\nwould be to introduce a proxy module that imports and re-exports\n"),s("code",[t._v("chronicles")]),t._v(" while adding additional streams with "),s("code",[t._v("logStream")]),t._v(":")]),t._v(" "),s("div",{staticClass:"language-nim line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-nim"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" chronicles\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" chronicles\n\nlogStream transactions"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("json"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("transactions"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),t._v("json"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br")])]),s("p",[t._v("The expression expected by "),s("code",[t._v("logStream")]),t._v(" has exactly the same format\nas the compile-time option and produces the same effect. In this particular\nexample, it will create a new stream called "),s("code",[t._v("transactions")]),t._v(" that will be sent\nto a JSON file named "),s("code",[t._v("transactions.json")]),t._v(".")]),t._v(" "),s("p",[t._v("After importing the proxy module, you'll be able to create records with any\nof the logging statements in the usual way:")]),t._v(" "),s("div",{staticClass:"language-nim line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-nim"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" transactions_log\n\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n\ntransactions"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),t._v("error "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"payment gateway time-out"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" orderId"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                    networkStatus "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("obtainNetworkStatus")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br")])]),s("h3",{attrs:{id:"customlogstream"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#customlogstream"}},[t._v("#")]),t._v(" "),s("code",[t._v("customLogStream")])]),t._v(" "),s("p",[s("code",[t._v("customLogStream")]),t._v(" enables you to implement arbitrary log formats and\ndestinations.")]),t._v(" "),s("p",[t._v('Each logging statement is translated to a set of calls operating over\na structure called "Log Record" (with one instance created per logging\nstatement). New log formats can be implemented by defining a suitable\nlog record type. Let\'s demonstrate this by implementing a simple XML logger:')]),t._v(" "),s("div",{staticClass:"language-nim line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-nim"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" xmltree"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" chronicles\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" XmlRecord"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Output"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("object")]),t._v("\n  output"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Output\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("template")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("initLogRecord"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("r"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" XmlRecord"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" lvl"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" LogLevel"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                        topics"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" string"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" string"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("\n  r"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),t._v("output"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),t._v("append "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"<event name=\\""')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("escape")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\" severity=\\""')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("$")]),t._v("lvl"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\">\\n"')]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("template")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setProperty"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("r"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" XmlRecord"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" key"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" string"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" val"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" auto"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("\n  r"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),t._v("output"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),t._v("append textBlockIndent"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"<"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('">"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("escape")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("$")]),t._v("val"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"</"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('">\\n"')]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("template")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setFirstProperty"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("r"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" XmlRecord"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" key"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" string"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" val"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" auto"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("\n  r"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),t._v("setProperty key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" val\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("template")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("flushRecord"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("r"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" XmlRecord"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("\n  r"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),t._v("output"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),t._v("append "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"</event>\\n"')]),t._v("\n  r"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),t._v("output"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),t._v("flushOutput\n\ncustomLogStream xmlout"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("XmlRecord"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("StdOutOutput"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\npublicLogScope"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n  stream "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" xmlout\n\ninfo "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"New Video"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" franchise "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Tom & Jerry"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" episode "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Smarty Cat"')]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br"),s("span",{staticClass:"line-number"},[t._v("23")]),s("br"),s("span",{staticClass:"line-number"},[t._v("24")]),s("br"),s("span",{staticClass:"line-number"},[t._v("25")]),s("br")])]),s("p",[t._v("The produced output from the example will be:")]),t._v(" "),s("div",{staticClass:"language-xml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("event")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("New Video"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("severity")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("INFO"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("tid")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("0"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("tid")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("episode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("Smarty Cat"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("episode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("franchise")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("Tom "),s("span",{pre:!0,attrs:{class:"token entity named-entity",title:"&"}},[t._v("&amp;")]),t._v(" Jerry"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("franchise")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("event")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br")])]),s("p",[t._v("As you can see, "),s("code",[t._v("customLogStream")]),t._v(" looks similar to a regular "),s("code",[t._v("logStream")]),t._v(",\nbut it expects a log record type as its only argument.")]),t._v(" "),s("p",[t._v("The record type is implemented by providing suitable definitons for\n"),s("code",[t._v("initLogRecord")]),t._v(", "),s("code",[t._v("setFirstProperty")]),t._v(", "),s("code",[t._v("setProperty")]),t._v(" and "),s("code",[t._v("flushRecord")]),t._v(".\nWe recommend defining these operations as templates because this will\nfacilitate the aggressive constant-folding employed by Chronicles (discussed\nin more details in the next section). We also recommend making your log\nrecord types parametric on an "),s("code",[t._v("Output")]),t._v(" type, because this will allow the\nusers of the code to specify any of the output types defined in Chronicles\nitself (see the module "),s("code",[t._v("log_output")]),t._v(" for a list of those).")]),t._v(" "),s("p",[t._v("As demonstrated in the example above, you can set the "),s("code",[t._v("stream")]),t._v(" property in\na Chronicles lexical scope to redirect all unqualified log statements to a\nparticular default stream.")]),t._v(" "),s("h2",{attrs:{id:"cost-of-abstractions-and-implementation-details"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cost-of-abstractions-and-implementation-details"}},[t._v("#")]),t._v(" Cost of Abstractions and Implementation Details")]),t._v(" "),s("p",[t._v("Chronicles makes use of advanced compile-time programming techniques to\nproduce very efficient run-time code with minimal footprint.")]),t._v(" "),s("p",[t._v("The properties from lexical scopes are merged at compile-time with the\nlog statement arguments and if any constant variables are about to be\nsent to the log output, they will be first concatenated by the compiler\nin order to issue the minimum number of "),s("code",[t._v("write")]),t._v(" operations possible.")]),t._v(" "),s("p",[t._v("The dynamic scopes store their run-time bindings on the stack, in special\nframe structures forming a linked list. This list is traversed on each log\nstatement and each active property leads to one dynamically dispatched call.")]),t._v(" "),s("p",[t._v("To support constant-time topic filtering and property overriding in dynamic\nscopes, Chronicles consumes a large amount of thread-local memory, roughly\nproportional to the number of unique topic names and property names used\nin the program.")]),t._v(" "),s("h2",{attrs:{id:"future-directions"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#future-directions"}},[t._v("#")]),t._v(" Future Directions")]),t._v(" "),s("p",[t._v("At the moment, Chronicles intentionally omits certain features expected\nfrom a logging library such as log rotation and archival. We recommend\nfollowing the guidelines set in the "),s("a",{attrs:{href:"https://12factor.net/logs",target:"_blank",rel:"noopener noreferrer"}},[t._v("12-factor app methodology"),s("OutboundLink")],1),t._v("\nand sending your log output to "),s("code",[t._v("stdout")]),t._v(". It should be the responsibility\nof the supervising daemon of the app to implement log rotation and archival.")]),t._v(" "),s("p",[t._v("We understand that certain users would want to take advantage of the\nfile sinks provided by Chronicles and these users may benefit from the\naforementioned features. If the Nim community provides a package for\na low-level abstraction of an automatically rotated and archived log\nfile, Chronicles will provide options for using it.")])])}),[],!1,null,null,null);e.default=n.exports}}]);