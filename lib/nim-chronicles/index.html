<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Chronicles | Nimbus Libraries</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/assets/img/logo.png">
    <meta name="description" content="Ethereum 2.0 utilities and more">
    
    <link rel="preload" href="/assets/css/0.styles.74783a08.css" as="style"><link rel="preload" href="/assets/js/app.69cb3ce0.js" as="script"><link rel="preload" href="/assets/js/2.0fdcf826.js" as="script"><link rel="preload" href="/assets/js/9.663c1542.js" as="script"><link rel="prefetch" href="/assets/js/10.2077e70a.js"><link rel="prefetch" href="/assets/js/11.b2ef0f0e.js"><link rel="prefetch" href="/assets/js/3.8a4d3eed.js"><link rel="prefetch" href="/assets/js/4.b9b777bd.js"><link rel="prefetch" href="/assets/js/5.073c37d9.js"><link rel="prefetch" href="/assets/js/6.7db49fe2.js"><link rel="prefetch" href="/assets/js/7.bf8b68e5.js"><link rel="prefetch" href="/assets/js/8.b8ee59fd.js">
    <link rel="stylesheet" href="/assets/css/0.styles.74783a08.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/assets/img/logo.png" alt="Nimbus Libraries" class="logo"> <span class="site-name can-hide">Nimbus Libraries</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/lib/nim-chronicles/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Chronicles
</a></div><div class="nav-item"><a href="/lib/nim-eth/" class="nav-link">
  Eth
</a></div><div class="nav-item"><a href="/lib/nim-stew/" class="nav-link">
  Stew
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/lib/nim-chronicles/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Chronicles
</a></div><div class="nav-item"><a href="/lib/nim-eth/" class="nav-link">
  Eth
</a></div><div class="nav-item"><a href="/lib/nim-stew/" class="nav-link">
  Stew
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Chronicles</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/lib/nim-chronicles/#logging-scopes" class="sidebar-link">Logging Scopes</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/lib/nim-chronicles/#logscope" class="sidebar-link">logScope</a></li><li class="sidebar-sub-header"><a href="/lib/nim-chronicles/#publiclogscope" class="sidebar-link">publicLogScope</a></li><li class="sidebar-sub-header"><a href="/lib/nim-chronicles/#dynamiclogscope" class="sidebar-link">dynamicLogScope</a></li></ul></li><li><a href="/lib/nim-chronicles/#compile-time-configuration" class="sidebar-link">Compile-Time Configuration</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/lib/nim-chronicles/#chronicles-sinks" class="sidebar-link">chronicles_sinks</a></li><li class="sidebar-sub-header"><a href="/lib/nim-chronicles/#chronicles-default-output-device" class="sidebar-link">chroniclesdefaultoutput_device</a></li><li class="sidebar-sub-header"><a href="/lib/nim-chronicles/#chronicles-streams" class="sidebar-link">chronicles_streams</a></li><li class="sidebar-sub-header"><a href="/lib/nim-chronicles/#chronicles-enabled-topics" class="sidebar-link">chroniclesenabledtopics</a></li><li class="sidebar-sub-header"><a href="/lib/nim-chronicles/#chronicles-required-topics" class="sidebar-link">chroniclesrequiredtopics</a></li><li class="sidebar-sub-header"><a href="/lib/nim-chronicles/#chronicles-disabled-topics" class="sidebar-link">chroniclesdisabledtopics</a></li><li class="sidebar-sub-header"><a href="/lib/nim-chronicles/#chronicles-disable-thread-id" class="sidebar-link">chroniclesdisablethread_id</a></li><li class="sidebar-sub-header"><a href="/lib/nim-chronicles/#chronicles-log-level" class="sidebar-link">chroniclesloglevel</a></li><li class="sidebar-sub-header"><a href="/lib/nim-chronicles/#chronicles-runtime-filtering" class="sidebar-link">chroniclesruntimefiltering</a></li><li class="sidebar-sub-header"><a href="/lib/nim-chronicles/#chronicles-timestamps" class="sidebar-link">chronicles_timestamps</a></li><li class="sidebar-sub-header"><a href="/lib/nim-chronicles/#chronicles-line-numbers" class="sidebar-link">chronicleslinenumbers</a></li><li class="sidebar-sub-header"><a href="/lib/nim-chronicles/#chronicles-colors" class="sidebar-link">chronicles_colors</a></li><li class="sidebar-sub-header"><a href="/lib/nim-chronicles/#chronicles-indent" class="sidebar-link">chronicles_indent</a></li></ul></li><li><a href="/lib/nim-chronicles/#working-with-file-outputs" class="sidebar-link">Working with file outputs</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/lib/nim-chronicles/#working-with-dynamic-outputs" class="sidebar-link">Working with dynamic outputs</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/lib/nim-chronicles/#using-chronicles-with-nosideeffect" class="sidebar-link">Using Chronicles with {.noSideEffect.}</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/lib/nim-chronicles/#teaching-chronicles-about-your-types" class="sidebar-link">Teaching Chronicles about your types</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/lib/nim-chronicles/#formatit" class="sidebar-link">formatIt</a></li><li class="sidebar-sub-header"><a href="/lib/nim-chronicles/#expandit" class="sidebar-link">expandIt</a></li></ul></li><li><a href="/lib/nim-chronicles/#custom-log-streams" class="sidebar-link">Custom Log Streams</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/lib/nim-chronicles/#logstream" class="sidebar-link">logStream</a></li><li class="sidebar-sub-header"><a href="/lib/nim-chronicles/#customlogstream" class="sidebar-link">customLogStream</a></li></ul></li><li><a href="/lib/nim-chronicles/#cost-of-abstractions-and-implementation-details" class="sidebar-link">Cost of Abstractions and Implementation Details</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/lib/nim-chronicles/#future-directions" class="sidebar-link">Future Directions</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="chronicles"><a href="#chronicles" class="header-anchor">#</a> Chronicles</h1> <p>Chronicles is a library for structured logging. It adheres to the philosophy
that log files shouldn't be based on formatted text strings, but rather on
well-defined event records with arbitrary properties that are easy to read
for both humans and machines. Let's illustrate this with an example:</p> <div class="language-nim line-numbers-mode"><pre class="language-nim"><code><span class="token keyword">import</span> net<span class="token punctuation">,</span> chronicles

socket<span class="token operator">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token operator">..</span><span class="token punctuation">.)</span>
<span class="token operator">...</span>
debug <span class="token string">&quot;Client PSK&quot;</span><span class="token punctuation">,</span> psk <span class="token operator">=</span> client<span class="token operator">.</span>getPskIdentity
info <span class="token string">&quot;New incoming connection&quot;</span><span class="token punctuation">,</span> remoteAddr <span class="token operator">=</span> ip<span class="token punctuation">,</span> remotePort <span class="token operator">=</span> port

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>Here, <code>debug</code> and <code>info</code> are logging statements, corresponding to different
severity levels. You can think of their first argument as the name of a
particular event that happened during the execution of the program, while
the rest of the arguments are the properties of this event.</p> <p>From these logging statements, Chronicles can be configured to produce log
output in various structured formats. The default format is called <code>textlines</code>
and it looks like this:</p> <p><img src="https://github.com/status-im/nim-chronicles/raw/master/media/textlines.svg?sanitize=true" alt="textblocks format example"></p> <p>This format is compatible with tooling written for
<a href="https://brandur.org/logfmt" target="_blank" rel="noopener noreferrer">heroku/logfmt<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>Alternatively, you can use a multi-line format called <code>textblocks</code>:</p> <p><img src="https://github.com/status-im/nim-chronicles/raw/master/media/textblocks.svg?sanitize=true" alt="textblocks format example"></p> <p>While these human-readable formats provide a more traditional and familiar
experience of using a logging library, the true power of Chronicles is
unlocked only after switching to the <code>JSON</code> format. Then, the same log output
will look like this:</p> <p><img src="https://github.com/status-im/nim-chronicles/raw/master/media/json.svg?sanitize=true" alt="json format example"></p> <p>At first, switching to JSON may look like a daunting proposition, but
Chronicles provides a customized log tailing program called <code>chronicles-tail</code>
which is able to transform the JSON stream back into the familiar human-readable
form, while also providing additional advanced features such as on on-the-fly
filtering, sound alerts and more.</p> <p>The main advantage of using JSON logging is that this facilitates the storage
of the log records in specialized databases which are usually able to provide
search and filtering capabilities and allow you to compute various aggregated
metrics and time-series data from the accumulated logs.</p> <p>Typical log storage choices for the above are open-source search engines such
as <a href="https://www.elastic.co/" target="_blank" rel="noopener noreferrer">ElasticSearch<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> or specialized providers such as <a href="https://www.loggly.com/" target="_blank" rel="noopener noreferrer">Loggly<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h2 id="logging-scopes"><a href="#logging-scopes" class="header-anchor">#</a> Logging Scopes</h2> <p>In the introduction, we saw <code>debug</code> and <code>info</code> as examples for logging
statements. Other similar statements include <code>trace</code>, <code>notice</code>, <code>warn</code>, <code>error</code>
and <code>fatal</code>. All of these statements accept arbitrary key-value pairs.
As a short-cut, you are also allowed to specify only the name of a particular
variable and Chronicles will create a key with the same name (i.e. passing
a local variable named <code>foo</code> will be translated to the pair <code>foo = foo</code>).</p> <p>A common practice enforced in other logging libraries is to associate
the logging records with the name of the component that produced them
or with a particular run-time property such as <code>RequestID</code>. Chronicles
provides two general-purpose facilities for assigning such properties
in an automated way:</p> <h3 id="logscope"><a href="#logscope" class="header-anchor">#</a> <code>logScope</code></h3> <p><code>logScope</code> can be used to introduce additional properties that will be
automatically attached to all logging statements in the current lexical
scope:</p> <div class="language-nim line-numbers-mode"><pre class="language-nim"><code>logScope<span class="token operator">:</span>
  <span class="token comment"># Lexical properties are typically assigned to a constant:</span>
  topics <span class="token operator">=</span> <span class="token string">&quot;rendering opengl&quot;</span>

  <span class="token comment"># But you can also assign an expression that will be</span>
  <span class="token comment"># evaluated on every log statement:</span>
  memoryUsage <span class="token operator">=</span> <span class="token function">currentMemUsage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">proc</span> <span class="token function">renderFrame</span><span class="token punctuation">(</span><span class="token operator">..</span><span class="token punctuation">.)</span> <span class="token operator">=</span>
  inc frameCounter

  logScope<span class="token operator">:</span>
    <span class="token comment"># You can add additional properties in any scope. Only logging</span>
    <span class="token comment"># statements that are in the same lexical scope will be affected:</span>
    frame <span class="token operator">=</span> frameCounter

  <span class="token keyword">var</span> t <span class="token operator">=</span> <span class="token function">startTimer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  debug <span class="token string">&quot;Frame started&quot;</span>

  <span class="token operator">...</span>

  <span class="token function">glFinish</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  debug <span class="token string">&quot;Frame finished&quot;</span><span class="token punctuation">,</span> totalPrimitives<span class="token punctuation">,</span> frameTime <span class="token operator">=</span> t<span class="token operator">.</span>elapsed
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>A <code>logScope</code> is usually put near the top of a Nim module and used to
specify statically assigned properties such as message origin, component
name, etc. The special <code>topics</code> property demonstrated here is important
for the log filtering mechanism, which will be explained in more details
later. If present, this property will always appear first in the formatted
log output.</p> <h3 id="publiclogscope"><a href="#publiclogscope" class="header-anchor">#</a> <code>publicLogScope</code></h3> <p>While a <code>logScope</code> affects only the current module, a <code>publicLogScope</code>
allows you to specify a set of custom properties that may affect your
entire program. For example, if you have an application running in a
server cluster, you may want to assign a property such as <code>serverId</code>
to every record. To achieve this, create a proxy logging module
importing <code>chronicles</code> and setting up a <code>publicLogScope</code>:</p> <div class="language-nim line-numbers-mode"><pre class="language-nim"><code><span class="token comment"># logging.nim</span>

<span class="token keyword">import</span> chronicles

<span class="token keyword">proc</span> <span class="token function">getServerId<span class="token operator">*</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>

publicLogScope<span class="token operator">:</span>
  serverId <span class="token operator">=</span> <span class="token function">getServerId</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>Every other module importing the proxy module will be able to use the
entire Chronicles API and will be affected by the public scope.
In fact, you should not import <code>chronicles</code> from such modules, because
this will lead to ambiguous symbols such as <code>activeChroniclesScope</code> and
<code>activeChroniclesStream</code>.</p> <p>Using Nim's <code>--import:</code> option may be a good way to enforce the use of
the proxy module in your entire program.</p> <h3 id="dynamiclogscope"><a href="#dynamiclogscope" class="header-anchor">#</a> <code>dynamicLogScope</code></h3> <p>A <code>dynamicLogScope</code> is a construct accepting a block of code that can be
used to attach properties to all logging statements that will be executed
anywhere within the tree of calls originating from the said block. The key
difference with the lexically bound properties is that this includes
logging statements from other modules, which are not within the lexical
scope of the <code>dynamicLogScope</code> statement.</p> <p>If you still find the distinction between lexical and dynamic scopes confusing,
reading the following explanation may help you:</p> <p>http://wiki.c2.com/?DynamicScoping</p> <p>A dynamic scope is usually used to track the reason why a particular
library function is being called (e.g. you are opening a file as a result
of a particular network request):</p> <div class="language-nim line-numbers-mode"><pre class="language-nim"><code><span class="token keyword">proc</span> <span class="token function">onNewRequest</span><span class="token punctuation">(</span>req<span class="token operator">:</span> Request<span class="token punctuation">)</span> <span class="token operator">=</span>
  inc reqID
  info <span class="token string">&quot;request received&quot;</span><span class="token punctuation">,</span> reqID<span class="token punctuation">,</span> origin <span class="token operator">=</span> req<span class="token operator">.</span>remoteAddress
  <span class="token function">dynamicLogScope</span><span class="token punctuation">(</span>reqID<span class="token punctuation">)</span><span class="token operator">:</span>
    <span class="token comment"># All logging statements triggered before the current block returns</span>
    <span class="token comment"># will feature the reqID property. This includes logging statements</span>
    <span class="token comment"># from other modules.</span>
    <span class="token function">handleRequest</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>Just like regular log statements, <code>dynamicLogScope</code> accepts a list of arbitrary
key-value pairs. The use of <code>reqID</code> in the example above is a convenient short
form for specifying the pair <code>reqID = reqID</code>.</p> <p>While the properties associated with lexical scopes are lazily evaluated as
previously demonstrated, all expressions at the beginning of a dynamic scope
will be eagerly evaluated before the block is entered.</p> <h2 id="compile-time-configuration"><a href="#compile-time-configuration" class="header-anchor">#</a> Compile-Time Configuration</h2> <p>Almost everything about Chronicles in configured at compile-time, through the
mechanism of Nim's <code>-d:</code> flags. For example, you can completely remove all of
the code related to logging by simply setting <code>chronicles_enabled</code> to <code>off</code>:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>nim c -d:chronicles_enabled=off myprogram.nim
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Chronicles comes with a very reasonable default configuration, but let's look
at some of the other supported options:</p> <h3 id="chronicles-sinks"><a href="#chronicles-sinks" class="header-anchor">#</a> chronicles_sinks</h3> <p>Chronicles supports producing log records in multiple formats and writing
those to various destinations such as the std streams, the system's syslog
daemon, or to one or more log files.</p> <p>The combination of a log format and one or more associated log destinations
is called a 'sink'. You can use the <code>chronicles_sinks</code> option to provide the
list of sinks that will be used in your program.</p> <p>The sinks are specified as a comma-separated list of valid Nim expressions
that will be better illustrated by the following examples:</p> <ul><li><p><code>json</code></p> <p>Write JSON-records to stdout</p></li> <li><p><code>json[file]</code></p> <p>Write JSON-records to a file in the current directory named after the
application itself.</p></li> <li><p><code>textblocks[stdout,file(/var/log/myapp.log)]</code></p> <p>Use the 'textblocks' format and send the output both to stdout and
to a file with an absolute path /var/log/myapp.log</p></li> <li><p><code>textlines[notimestamps,file(myapp.txt),syslog]</code></p> <p>Use the 'textlines' format, but don't include timestamps and write
both to a file named 'myapp.txt' with a relative path to the current
working directory and also to syslog.</p></li> <li><p><code>textlines[nocolors],json[file(logs/myapp.json,truncate)]</code></p> <p>Send the output both in the 'textlines' format to stdout (but without
using colors) and to a JSON file named myapp.json in the relative
directory 'logs'. The  myapp.json file will be truncated on each
program execution.</p></li></ul> <p>The built-in formats include <code>json</code>, <code>textlines</code> and <code>textblocks</code>, which
support options for specifying the use of colors and timestamps (for more
info see <code>chronicles_colors</code> and <code>chronicles_timestamps</code>).</p> <p>The possible log destinations are <code>stdout</code>, <code>stderr</code>, <code>file</code>, <code>syslog</code>
and <code>dynamic</code>.</p> <p>Please note that Chronicles also allows you to implement custom logging
formats through the use of the <code>customLogStream</code> facility.</p> <h3 id="chronicles-default-output-device"><a href="#chronicles-default-output-device" class="header-anchor">#</a> chronicles_default_output_device</h3> <p>When a sink doesn't explicitly specify a particular log destination,
Chronicles will log to &quot;stdout&quot; by default. Use this define to specify
a different default choice.</p> <h3 id="chronicles-streams"><a href="#chronicles-streams" class="header-anchor">#</a> chronicles_streams</h3> <p>While having multiple log sinks enables you to record the same stream of
events in multiple formats and destinations, <code>chronicles_streams</code> allows
you to define additional independent streams of events identified by their
name. In the code, each logging statement is associated with exactly one
log stream, which in turn has an associated list of sinks.</p> <p>The syntax for defining streams closely resembles the syntax for defining
sinks:</p> <ul><li><code>textlog[textlines],transactions[json[file(transactions.json)]]</code></li></ul> <p>This will create two streams, called <code>textlog</code> and <code>transactions</code>.
The former will be considered the default stream associated with unqualified
logging statements, but each of the streams will exist as a separate symbol
in the code, supporting the full set of logging operations:</p> <div class="language-nim line-numbers-mode"><pre class="language-nim"><code>textlog<span class="token operator">.</span>debug <span class="token string">&quot;about to create a transaction&quot;</span>
transactions<span class="token operator">.</span>info <span class="token string">&quot;transaction created&quot;</span><span class="token punctuation">,</span> buyer <span class="token operator">=</span> alice<span class="token punctuation">,</span> seller <span class="token operator">=</span> bob
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>The streams created through <code>chronicles_streams</code> will be exported by the
<code>chronicles</code> module itself, but you can also introduce additional streams
in your own modules by using the helpers <code>logStream</code> and <code>customLogStream</code>.</p> <h3 id="chronicles-enabled-topics"><a href="#chronicles-enabled-topics" class="header-anchor">#</a> chronicles_enabled_topics</h3> <p>All logging statements may be associated with a statically known list of
topics. Usually, this is done by specifying the <code>topics</code> property in a
particular <code>logScope</code>, but you can also specify it for individual log
statements.</p> <p>You can use the <code>chronicles_enabled_topics</code> option to specify the list of
topics for which the logging statements should produce output. All other
logging statements will be erased at compile-time from the final code.
When the list includes multiple topics, any of them is considered a match.</p> <blockquote><p>In both contexts, the list of topics is written as a comma or space-separated
string of case-sensitive topic names.</p></blockquote> <p>In the list of topics, you can also optionally provide a log level after the
topic, separated with a colon from the topic. If a log level is provided it will
overrule the <code>chronicles_log_level</code> setting. The log level can be defined as
<code>LogLevel</code> values or directly as the corresponding integer values.</p> <p>e.g. <code>-d:chronicles_enabled_topics:MyTopic:DEBUG,AnotherTopic:5</code></p> <h3 id="chronicles-required-topics"><a href="#chronicles-required-topics" class="header-anchor">#</a> chronicles_required_topics</h3> <p>Similar to <code>chronicles_enabled_topics</code>, but requires the logging statements
to have all of the topics specified in this list.</p> <p>You cannot specify <code>chronicles_enabled_topics</code> and <code>chronicles_required_topics</code>
at the same time.</p> <h3 id="chronicles-disabled-topics"><a href="#chronicles-disabled-topics" class="header-anchor">#</a> chronicles_disabled_topics</h3> <p>The dual of <code>chronicles_enabled_topics</code>. This option specifies a black-list
of topics for which the associated logging statements should be erased from
the program.</p> <p>Topics in <code>chronicles_disabled_topics</code> have precedence over the ones in
<code>chronicles_enabled_topics</code> or <code>chronicles_required_topics</code>.</p> <h3 id="chronicles-disable-thread-id"><a href="#chronicles-disable-thread-id" class="header-anchor">#</a> chronicles_disable_thread_id</h3> <p>Disable log thread(tid)</p> <h3 id="chronicles-log-level"><a href="#chronicles-log-level" class="header-anchor">#</a> chronicles_log_level</h3> <p>This option can be used to erase at compile-time all log statements, not
matching the specified minimum log level.</p> <p>Possible values are <code>TRACE</code>, <code>DEBUG</code>, <code>INFO</code>, <code>NOTICE</code>, <code>WARN</code>, <code>ERROR</code>, <code>FATAL</code>,
and <code>NONE</code>. The default value is <code>DEBUG</code> in debug builds and <code>INFO</code> in
release mode.</p> <h3 id="chronicles-runtime-filtering"><a href="#chronicles-runtime-filtering" class="header-anchor">#</a> chronicles_runtime_filtering</h3> <p>This option enables the run-filtering capabilities of Chronicles.
The run-time filtering is controlled through the procs <code>setLogLevel</code>
and <code>setTopicState</code>:</p> <div class="language-nim line-numbers-mode"><pre class="language-nim"><code><span class="token keyword">type</span> LogLevel <span class="token operator">=</span> <span class="token keyword">enum</span>
  NONE<span class="token punctuation">,</span> TRACE<span class="token punctuation">,</span> DEBUG<span class="token punctuation">,</span> INFO<span class="token punctuation">,</span> NOTICE<span class="token punctuation">,</span> WARN<span class="token punctuation">,</span> ERROR<span class="token punctuation">,</span> FATAL

<span class="token keyword">proc</span> <span class="token function">setLogLevel<span class="token operator">*</span></span><span class="token punctuation">(</span>level<span class="token operator">:</span> LogLevel<span class="token punctuation">)</span>

<span class="token keyword">type</span> TopicState <span class="token operator">=</span> <span class="token keyword">enum</span>
  Normal<span class="token punctuation">,</span> Enabled<span class="token punctuation">,</span> Required<span class="token punctuation">,</span> Disabled

<span class="token keyword">proc</span> <span class="token function">setTopicState<span class="token operator">*</span></span><span class="token punctuation">(</span>name<span class="token operator">:</span> string<span class="token punctuation">,</span>
                    newState<span class="token operator">:</span> TopicState<span class="token punctuation">,</span>
                    logLevel <span class="token operator">=</span> LogLevel<span class="token operator">.</span>NONE<span class="token punctuation">)</span><span class="token operator">:</span> bool
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>The log levels available at runtime - and therefor to <code>setLogLevel()</code> - are
those greater than or equal to the one set at compile time by
<code>chronicles_log_level</code>.</p> <p>It is also possible for a specific topic to overrule the global <code>LogLevel</code>, set
by <code>setLogLevel</code>, by setting the optional <code>logLevel</code> parameter in
<code>setTopicState</code> to a valid <code>LogLevel</code>.</p> <p>The option is disabled by default because we recommend filtering the
log output in a tailing program. This allows you to still look at all
logged events in case this becomes necessary. Set the option to <code>on</code>
to enable it.</p> <h3 id="chronicles-timestamps"><a href="#chronicles-timestamps" class="header-anchor">#</a> chronicles_timestamps</h3> <p>This option controls the use of timestamps in the log output.
Possible values are:</p> <ul><li><p><code>RfcTime</code> (used by default)</p> <p>Chronicles will use the human-readable format specified in
RFC 3339: Date and Time on the Internet: Timestamps</p> <p>https://tools.ietf.org/html/rfc3339</p></li> <li><p><code>UnixTime</code></p> <p>Chronicles will write a single float value for the number
of seconds since the &quot;Unix epoch&quot;</p> <p>https://en.wikipedia.org/wiki/Unix_time</p></li> <li><p><code>None</code> or <code>NoTimestamps</code></p> <p>Chronicles will not include timestamps in the log output.</p></li></ul> <p>Please note that the timestamp format can also be specified
for individual sinks (see <code>chronicles_sinks</code>).</p> <h3 id="chronicles-line-numbers"><a href="#chronicles-line-numbers" class="header-anchor">#</a> chronicles_line_numbers</h3> <p>This option, disabled by default, enables the display of filename and line number
where each record was instantiated. It adds a property <code>file</code> to the output, for example:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>file: example.nim:15
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>While <code>chronicles_line_numbers</code> sets the default option for all records, it is
also possible to control the same property in a lexical scope or for a particular
log statement with <code>chroniclesLineNumbers</code>, which can be either <code>true</code> or <code>false</code>.</p> <h3 id="chronicles-colors"><a href="#chronicles-colors" class="header-anchor">#</a> chronicles_colors</h3> <p>This option controls the default color scheme used by Chronicles for
its human-readable text formats when sent to the standard output streams.</p> <p>Possible values are:</p> <ul><li><p><code>NativeColors</code> (used by default)</p> <p>In this mode, Windows builds will produce output suitable for the console
application in older versions of Windows. On Unix-like systems, ANSI codes
are still used.</p></li> <li><p><code>AnsiColors</code></p> <p>Output suitable for terminals supporting the standard ANSI escape codes:
https://en.wikipedia.org/wiki/ANSI_escape_code</p> <p>This includes most terminal emulators on modern Unix-like systems,
Windows console replacements such as ConEmu, and the native Console
and PowerShell applications on Windows 10.</p></li> <li><p><code>None</code> or <code>NoColors</code></p> <p>Chronicles will produce color-less output. Please note that this is the
default mode for sinks logging only to files or for sinks using the json
format.</p></li></ul> <p>Current known limitations:</p> <ul><li>Chronicles will not try to detect if the standard outputs
of the program are being redirected to another program or a file.
It's typical for the colored output to be disabled in such circumstances.
(<a href="https://github.com/status-im/nim-chronicles/issues/1" target="_blank" rel="noopener noreferrer">issue<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>)</li></ul> <h3 id="chronicles-indent"><a href="#chronicles-indent" class="header-anchor">#</a> chronicles_indent</h3> <p>This option sets the desired number of spaces that Chronicles should
use as indentation in the <code>textblocks</code> format.</p> <hr> <p>All of the discussed options are case-insensitive and accept a number of
truthy and falsy values such as <code>on</code>, <code>off</code>, <code>true</code>, <code>false</code>, <code>0</code>, <code>1</code>,
<code>yes</code>, <code>no</code> or <code>none</code>.</p> <h2 id="working-with-file-outputs"><a href="#working-with-file-outputs" class="header-anchor">#</a> Working with <code>file</code> outputs</h2> <p>When a stream has <code>file</code> outputs, you may choose to provide the log file
location at run-time. Chronicles will create each log file lazily when the
first log record is written. This gives you a chance to modify the default
compile-time path associated with each file output by calling the <code>open</code>
proc on an <code>output</code> symbol associated with the stream:</p> <div class="language-nim line-numbers-mode"><pre class="language-nim"><code><span class="token comment"># my_program.nim</span>

<span class="token keyword">var</span> config <span class="token operator">=</span> <span class="token function">loadConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> success <span class="token operator">=</span> defaultChroniclesStream<span class="token operator">.</span>output<span class="token operator">.</span><span class="token function">open</span><span class="token punctuation">(</span>config<span class="token operator">.</span>logFile<span class="token punctuation">,</span> fmAppend<span class="token punctuation">)</span>

info <span class="token string">&quot;APPLICATION STARTED&quot;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>Compiled with:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>nim c -d:chronicles_sinks=textlines[file] my_program.nim
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>As you can see above, the default stream in Chronicles is called
<code>defaultChroniclesStream</code>. If the stream had multiple file outputs,
they would have been accessible separately as <code>outputs[0]</code>, <code>outputs[1]</code>
and so on. <code>output</code> is a simple short-cut referring to the first of them.</p> <p>When the compile-time configuration doesn't specify a default file name for
a particular file output, Chronicles will use the following rules for picking
the default automatically:</p> <ol><li><p>The log file is created in the current working directory and its name
matches the name of the stream (plus a <code>.log</code> extension). The exception
for this rule is the default stream, for which the log file will be
assigned the name of the application binary.</p></li> <li><p>If more than one unnamed file outputs exist for a given stream,
chronicles will add an index such as <code>.2.log</code>, <code>.3.log</code> .. <code>.N.log</code>
to the final file name.</p></li></ol> <h2 id="working-with-dynamic-outputs"><a href="#working-with-dynamic-outputs" class="header-anchor">#</a> Working with <code>dynamic</code> outputs</h2> <p>A <code>dynamic</code> output redirects all logged messages to a closure supplied by
the host application. Similar to working with file ouputs <a href="#working-with-file-outputs">file outputs</a>,
you can use the <code>output</code> and <code>outputs</code> properties of a Chronicles stream
to specify a gcsafe closure:</p> <div class="language-nim line-numbers-mode"><pre class="language-nim"><code>defaultChroniclesStream<span class="token operator">.</span>output<span class="token operator">.</span>writer <span class="token operator">=</span>
  <span class="token keyword">proc</span> <span class="token punctuation">(</span>logLevel<span class="token operator">:</span> LogLevel<span class="token punctuation">,</span> msg<span class="token operator">:</span> LogOutputStr<span class="token punctuation">)</span> <span class="token punctuation">{.</span>gcsafe<span class="token punctuation">.}</span> <span class="token operator">=</span>
    database<span class="token operator">.</span><span class="token function">writeLogEntry</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="using-chronicles-with-nosideeffect"><a href="#using-chronicles-with-nosideeffect" class="header-anchor">#</a> Using Chronicles with <code>{.noSideEffect.}</code></h2> <p>Usage of Chronicles from <code>noSideEffect</code> procs (or <code>func</code>) is limited to the
<code>trace</code> statement. Normal logging can be considered a side effect, but <code>trace</code>
is meant as a debugging aid. It's analogous to Nim's <code>debugEcho</code>, which also
bypasses the effect system.</p> <h2 id="teaching-chronicles-about-your-types"><a href="#teaching-chronicles-about-your-types" class="header-anchor">#</a> Teaching Chronicles about your types</h2> <p>Chronicles can output log records in any of the formats supported by the Nim
<a href="https://github.com/status-im/nim-serialization" target="_blank" rel="noopener noreferrer"><code>serialization</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> package.
When you specify a named format such as <code>json</code>, Chronicles will expect that
your project also depends on the respective serialization package (e.g.
<a href="https://github.com/status-im/nim-json-serialization" target="_blank" rel="noopener noreferrer"><code>json_serialization</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>).</p> <p>In the text formats (<code>textlines</code> and <code>textblocks</code>), the Nim's standard <code>$</code>
operator will be used to convert the logged properties to strings.</p> <h3 id="formatit"><a href="#formatit" class="header-anchor">#</a> <code>formatIt</code></h3> <p>You can instruct Chronicles to alter this default behavior for a particular
type by providing a <code>chronicles.formatIt</code> override:</p> <div class="language-nim line-numbers-mode"><pre class="language-nim"><code><span class="token keyword">type</span> Dollar <span class="token operator">=</span> <span class="token keyword">distinct</span> int
chronicles<span class="token operator">.</span><span class="token function">formatIt</span><span class="token punctuation">(</span>Dollar<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token string">&quot;$&quot;</span> <span class="token operator">&amp;</span> <span class="token operator">$</span><span class="token punctuation">(</span>it<span class="token operator">.</span>int<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>The <code>formatIt</code> block can evaluate to any expression that will be then
subjected to the standard serialization logic described above.</p> <h3 id="expandit"><a href="#expandit" class="header-anchor">#</a> <code>expandIt</code></h3> <p>The <code>expandIt</code> override can be used to turn any logged property of a
particular type into multiple properties:</p> <div class="language-nim line-numbers-mode"><pre class="language-nim"><code>chronicles<span class="token operator">.</span><span class="token function">expandIt</span><span class="token punctuation">(</span>EncryptedEnvelope<span class="token punctuation">)</span><span class="token operator">:</span>
  peer <span class="token operator">=</span> it<span class="token operator">.</span>fromAddress
  msg  <span class="token operator">=</span> it<span class="token operator">.</span>decryptMsg

<span class="token operator">...</span>

<span class="token keyword">var</span> e <span class="token operator">=</span> <span class="token function">EncryptedEnvelope</span><span class="token punctuation">(</span><span class="token operator">..</span><span class="token punctuation">.)</span>

<span class="token comment"># The following two statements are equivalent:</span>
info <span class="token string">&quot;Received message&quot;</span><span class="token punctuation">,</span> e
info <span class="token string">&quot;Received message&quot;</span><span class="token punctuation">,</span> peer <span class="token operator">=</span> e<span class="token operator">.</span>fromAddress<span class="token punctuation">,</span> msg <span class="token operator">=</span> e<span class="token operator">.</span>decryptMsg
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>You can also derive the names of the expanded properties from the name of
the original logged property. This is achieved by using the Nim's backticks
syntax to construct the expanded property names:</p> <div class="language-nim line-numbers-mode"><pre class="language-nim"><code>chronicles<span class="token operator">.</span><span class="token function">expandIt</span><span class="token punctuation">(</span>User<span class="token punctuation">)</span><span class="token operator">:</span>
  <span class="token comment"># You can use both identifiers and string literals:</span>
  <span class="token ignore"><span class="token punctuation">`</span>it Name<span class="token punctuation">`</span></span> <span class="token operator">=</span> it<span class="token operator">.</span>name
  <span class="token punctuation">`</span>it <span class="token string">&quot;LastSeen&quot;</span><span class="token punctuation">`</span> <span class="token operator">=</span> it<span class="token operator">.</span>lastSeen

<span class="token operator">...</span>

<span class="token keyword">var</span> alice <span class="token operator">=</span> <span class="token function">User</span><span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token string">&quot;Alice&quot;</span><span class="token punctuation">,</span> <span class="token operator">..</span><span class="token punctuation">.)</span>

<span class="token comment"># The following two statements are equivalent:</span>
info <span class="token string">&quot;Sending message&quot;</span><span class="token punctuation">,</span> recipient <span class="token operator">=</span> alice
info <span class="token string">&quot;Sending message&quot;</span><span class="token punctuation">,</span> recipientName <span class="token operator">=</span> alice<span class="token operator">.</span>name<span class="token punctuation">,</span> recipientLastSeen <span class="token operator">=</span> alice<span class="token operator">.</span>lastSeen
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="custom-log-streams"><a href="#custom-log-streams" class="header-anchor">#</a> Custom Log Streams</h2> <h3 id="logstream"><a href="#logstream" class="header-anchor">#</a> <code>logStream</code></h3> <p>As an alternative to specifying multiple output streams with the
<code>chronicles_streams</code> option, you can also introduce additional
streams within the code of your program. A typical way to do this
would be to introduce a proxy module that imports and re-exports
<code>chronicles</code> while adding additional streams with <code>logStream</code>:</p> <div class="language-nim line-numbers-mode"><pre class="language-nim"><code><span class="token keyword">import</span> chronicles
<span class="token keyword">export</span> chronicles

logStream transactions<span class="token punctuation">[</span>json<span class="token punctuation">[</span><span class="token function">file</span><span class="token punctuation">(</span>transactions<span class="token operator">.</span>json<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>The expression expected by <code>logStream</code> has exactly the same format
as the compile-time option and produces the same effect. In this particular
example, it will create a new stream called <code>transactions</code> that will be sent
to a JSON file named <code>transactions.json</code>.</p> <p>After importing the proxy module, you'll be able to create records with any
of the logging statements in the usual way:</p> <div class="language-nim line-numbers-mode"><pre class="language-nim"><code><span class="token keyword">import</span> transactions_log

<span class="token operator">...</span>

transactions<span class="token operator">.</span>error <span class="token string">&quot;payment gateway time-out&quot;</span><span class="token punctuation">,</span> orderId<span class="token punctuation">,</span>
                    networkStatus <span class="token operator">=</span> <span class="token function">obtainNetworkStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="customlogstream"><a href="#customlogstream" class="header-anchor">#</a> <code>customLogStream</code></h3> <p><code>customLogStream</code> enables you to implement arbitrary log formats and
destinations.</p> <p>Each logging statement is translated to a set of calls operating over
a structure called &quot;Log Record&quot; (with one instance created per logging
statement). New log formats can be implemented by defining a suitable
log record type. Let's demonstrate this by implementing a simple XML logger:</p> <div class="language-nim line-numbers-mode"><pre class="language-nim"><code><span class="token keyword">import</span> xmltree<span class="token punctuation">,</span> chronicles

<span class="token keyword">type</span> XmlRecord<span class="token punctuation">[</span>Output<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">object</span>
  output<span class="token operator">:</span> Output

<span class="token keyword">template</span> <span class="token function">initLogRecord<span class="token operator">*</span></span><span class="token punctuation">(</span>r<span class="token operator">:</span> <span class="token keyword">var</span> XmlRecord<span class="token punctuation">,</span> lvl<span class="token operator">:</span> LogLevel<span class="token punctuation">,</span>
                        topics<span class="token operator">:</span> string<span class="token punctuation">,</span> name<span class="token operator">:</span> string<span class="token punctuation">)</span> <span class="token operator">=</span>
  r<span class="token operator">.</span>output<span class="token operator">.</span>append <span class="token string">&quot;&lt;event name=\&quot;&quot;</span><span class="token punctuation">,</span> <span class="token function">escape</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;\&quot; severity=\&quot;&quot;</span><span class="token punctuation">,</span> <span class="token operator">$</span>lvl<span class="token punctuation">,</span> <span class="token string">&quot;\&quot;&gt;\n&quot;</span>

<span class="token keyword">template</span> <span class="token function">setProperty<span class="token operator">*</span></span><span class="token punctuation">(</span>r<span class="token operator">:</span> <span class="token keyword">var</span> XmlRecord<span class="token punctuation">,</span> key<span class="token operator">:</span> string<span class="token punctuation">,</span> val<span class="token operator">:</span> auto<span class="token punctuation">)</span> <span class="token operator">=</span>
  r<span class="token operator">.</span>output<span class="token operator">.</span>append textBlockIndent<span class="token punctuation">,</span> <span class="token string">&quot;&lt;&quot;</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token string">&quot;&gt;&quot;</span><span class="token punctuation">,</span> <span class="token function">escape</span><span class="token punctuation">(</span><span class="token operator">$</span>val<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;&lt;/&quot;</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token string">&quot;&gt;\n&quot;</span>

<span class="token keyword">template</span> <span class="token function">setFirstProperty<span class="token operator">*</span></span><span class="token punctuation">(</span>r<span class="token operator">:</span> <span class="token keyword">var</span> XmlRecord<span class="token punctuation">,</span> key<span class="token operator">:</span> string<span class="token punctuation">,</span> val<span class="token operator">:</span> auto<span class="token punctuation">)</span> <span class="token operator">=</span>
  r<span class="token operator">.</span>setProperty key<span class="token punctuation">,</span> val

<span class="token keyword">template</span> <span class="token function">flushRecord<span class="token operator">*</span></span><span class="token punctuation">(</span>r<span class="token operator">:</span> <span class="token keyword">var</span> XmlRecord<span class="token punctuation">)</span> <span class="token operator">=</span>
  r<span class="token operator">.</span>output<span class="token operator">.</span>append <span class="token string">&quot;&lt;/event&gt;\n&quot;</span>
  r<span class="token operator">.</span>output<span class="token operator">.</span>flushOutput

customLogStream xmlout<span class="token punctuation">[</span>XmlRecord<span class="token punctuation">[</span>StdOutOutput<span class="token punctuation">]</span><span class="token punctuation">]</span>

publicLogScope<span class="token operator">:</span>
  stream <span class="token operator">=</span> xmlout

info <span class="token string">&quot;New Video&quot;</span><span class="token punctuation">,</span> franchise <span class="token operator">=</span> <span class="token string">&quot;Tom &amp; Jerry&quot;</span><span class="token punctuation">,</span> episode <span class="token operator">=</span> <span class="token string">&quot;Smarty Cat&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>The produced output from the example will be:</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>event</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>New Video<span class="token punctuation">&quot;</span></span> <span class="token attr-name">severity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>INFO<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tid</span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tid</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>episode</span><span class="token punctuation">&gt;</span></span>Smarty Cat<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>episode</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>franchise</span><span class="token punctuation">&gt;</span></span>Tom <span class="token entity named-entity" title="&amp;">&amp;amp;</span> Jerry<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>franchise</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>event</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>As you can see, <code>customLogStream</code> looks similar to a regular <code>logStream</code>,
but it expects a log record type as its only argument.</p> <p>The record type is implemented by providing suitable definitons for
<code>initLogRecord</code>, <code>setFirstProperty</code>, <code>setProperty</code> and <code>flushRecord</code>.
We recommend defining these operations as templates because this will
facilitate the aggressive constant-folding employed by Chronicles (discussed
in more details in the next section). We also recommend making your log
record types parametric on an <code>Output</code> type, because this will allow the
users of the code to specify any of the output types defined in Chronicles
itself (see the module <code>log_output</code> for a list of those).</p> <p>As demonstrated in the example above, you can set the <code>stream</code> property in
a Chronicles lexical scope to redirect all unqualified log statements to a
particular default stream.</p> <h2 id="cost-of-abstractions-and-implementation-details"><a href="#cost-of-abstractions-and-implementation-details" class="header-anchor">#</a> Cost of Abstractions and Implementation Details</h2> <p>Chronicles makes use of advanced compile-time programming techniques to
produce very efficient run-time code with minimal footprint.</p> <p>The properties from lexical scopes are merged at compile-time with the
log statement arguments and if any constant variables are about to be
sent to the log output, they will be first concatenated by the compiler
in order to issue the minimum number of <code>write</code> operations possible.</p> <p>The dynamic scopes store their run-time bindings on the stack, in special
frame structures forming a linked list. This list is traversed on each log
statement and each active property leads to one dynamically dispatched call.</p> <p>To support constant-time topic filtering and property overriding in dynamic
scopes, Chronicles consumes a large amount of thread-local memory, roughly
proportional to the number of unique topic names and property names used
in the program.</p> <h2 id="future-directions"><a href="#future-directions" class="header-anchor">#</a> Future Directions</h2> <p>At the moment, Chronicles intentionally omits certain features expected
from a logging library such as log rotation and archival. We recommend
following the guidelines set in the <a href="https://12factor.net/logs" target="_blank" rel="noopener noreferrer">12-factor app methodology<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
and sending your log output to <code>stdout</code>. It should be the responsibility
of the supervising daemon of the app to implement log rotation and archival.</p> <p>We understand that certain users would want to take advantage of the
file sinks provided by Chronicles and these users may benefit from the
aforementioned features. If the Nim community provides a package for
a low-level abstraction of an automatically rotated and archived log
file, Chronicles will provide options for using it.</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.69cb3ce0.js" defer></script><script src="/assets/js/2.0fdcf826.js" defer></script><script src="/assets/js/9.663c1542.js" defer></script>
  </body>
</html>
